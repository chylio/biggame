<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ´»é†«å­¸å¤§å¯Œç¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* ç¦ç”¨é›™æ“Šç¸®æ”¾ */
        }
        .board {
            display: grid;
            grid-template-columns: 100px repeat(5, 1fr) 100px;
            grid-template-rows: 100px repeat(5, 1fr) 100px;
            gap: 4px;
            width: 100%;
            max-width: 800px;
            aspect-ratio: 1/1;
        }
        .cell {
            border: 2px solid #333;
            border-radius: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        /* å®šä½æ£‹ç›¤æ ¼å­ */
        .cell-0 { grid-column: 1 / 2; grid-row: 7 / 8; }
        .cell-1 { grid-column: 1 / 2; grid-row: 6 / 7; }
        .cell-2 { grid-column: 1 / 2; grid-row: 5 / 6; }
        .cell-3 { grid-column: 1 / 2; grid-row: 4 / 5; }
        .cell-4 { grid-column: 1 / 2; grid-row: 3 / 4; }
        .cell-5 { grid-column: 1 / 2; grid-row: 2 / 3; }
        .cell-6 { grid-column: 1 / 2; grid-row: 1 / 2; }
        .cell-7 { grid-column: 2 / 3; grid-row: 1 / 2; }
        .cell-8 { grid-column: 3 / 4; grid-row: 1 / 2; }
        .cell-9 { grid-column: 4 / 5; grid-row: 1 / 2; }
        .cell-10 { grid-column: 5 / 6; grid-row: 1 / 2; }
        .cell-11 { grid-column: 6 / 7; grid-row: 1 / 2; }
        .cell-12 { grid-column: 7 / 8; grid-row: 1 / 2; }
        .cell-13 { grid-column: 7 / 8; grid-row: 2 / 3; }
        .cell-14 { grid-column: 7 / 8; grid-row: 3 / 4; }
        .cell-15 { grid-column: 7 / 8; grid-row: 4 / 5; }
        .cell-16 { grid-column: 7 / 8; grid-row: 5 / 6; }
        .cell-17 { grid-column: 7 / 8; grid-row: 6 / 7; }
        .cell-18 { grid-column: 7 / 8; grid-row: 7 / 8; }
        .cell-19 { grid-column: 6 / 7; grid-row: 7 / 8; }
        .cell-20 { grid-column: 5 / 6; grid-row: 7 / 8; }
        .cell-21 { grid-column: 4 / 5; grid-row: 7 / 8; }
        .cell-22 { grid-column: 3 / 4; grid-row: 7 / 8; }
        .cell-23 { grid-column: 2 / 3; grid-row: 7 / 8; }
        .center-panel {
            grid-column: 2 / 7;
            grid-row: 2 / 7;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .player-piece {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.3s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* é¡è‰²ä¸»é¡Œ */
        .corner { background-color: #a3a3a3; color: white; }
        .property { background-color: #bae6fd; }
        .event { background-color: #fef08a; }
        .special { background-color: #d8b4fe; }
        .negative_event { background-color: #fca5a5; }

        /* éŠæˆ²çµæŸå½ˆçª— */
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ² ç”Ÿæ´»é†«å­¸å¤§å¯Œç¿ ğŸ²</h1>

    <div id="gameContainer" class="w-full max-w-4xl mx-auto flex flex-col lg:flex-row gap-6">
        
        <!-- å·¦å´éŠæˆ²è³‡è¨Š -->
        <div class="lg:w-1/4 bg-white p-6 rounded-2xl shadow-lg order-2 lg:order-1">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">ç©å®¶ç‹€æ…‹</h2>
            <div class="space-y-4 text-center">
                <div>
                    <p class="text-lg font-semibold">åŸå» å¥åº·è¨­å®š(HP)</p>
                    <p id="playerHP" class="text-4xl font-bold text-green-500">100</p>
                </div>
                <div>
                    <p class="text-lg font-semibold">ç›®å‰å›åˆ:</p>
                    <p id="currentRound" class="text-4xl font-bold text-blue-500">0 / 10</p>
                </div>
                <div class="h-24 flex flex-col justify-center">
                    <p class="text-lg font-semibold">æ“²éª°é»æ•¸:</p>
                    <p id="diceResult" class="text-6xl font-bold text-red-500">-</p>
                </div>
            </div>
            <button id="rollDiceBtn" class="mt-8 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-all text-xl shadow-md active:scale-95">
                æ“²éª°å­ ğŸ²
            </button>
            <!-- æ–°å¢ï¼šæ‰‹å‹•èª¿æ•´HP -->
            <div class="mt-4 pt-4 border-t">
                 <p class="text-lg font-semibold text-center mb-2">æ‰‹å‹•èª¿æ•´HP</p>
                 <div class="flex gap-2">
                     <input type="number" id="manualAddHpInput" class="w-full border-2 border-gray-300 rounded-lg p-2 text-center" placeholder="è¼¸å…¥å¢æ¸›å€¼">
                     <button id="manualAddHpBtn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 active:scale-95">ç¢ºèª</button>
                 </div>
            </div>
        </div>

        <!-- å³å´éŠæˆ²æ£‹ç›¤ -->
        <div class="flex-1 order-1 lg:order-2">
            <div id="board" class="board mx-auto bg-white p-2 rounded-2xl shadow-lg">
                <!-- æ£‹ç›¤æ ¼å­å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
                 <div class="center-panel bg-gray-200 rounded-lg">
                    <h3 class="text-xl md:text-2xl font-bold mb-2 text-center">äº‹ä»¶ç´€éŒ„</h3>
                    <div id="messageLog" class="w-full h-full bg-white rounded-lg p-4 text-sm md:text-base overflow-y-auto">
                        æ­¡è¿ä¾†åˆ°ç”Ÿæ´»é†«å­¸å¤§å¯Œç¿ï¼
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸå½ˆçª— -->
    <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0 modal">
        <div class="bg-white rounded-2xl p-8 text-center shadow-2xl transform scale-95 transition-transform">
            <h2 id="modalTitle" class="text-4xl font-bold mb-4">éŠæˆ²çµæŸï¼</h2>
            <p id="modalMessage" class="text-xl mb-6">ä½ çš„æœ€çµ‚å¥åº·é»æ•¸ç‚ºï¼š</p>
            <p id="finalScore" class="text-8xl font-bold text-green-500 mb-8">100</p>
            <button onclick="location.reload()" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all text-xl shadow-md">
                é‡æ–°é–‹å§‹
            </button>
        </div>
    </div>


    <script>
        // --- éŠæˆ²è¨­å®š ---
        const TOTAL_ROUNDS = 10;
        const STARTING_HP = 100;
        const PASS_START_HP = 300;

        // --- éŠæˆ²æ£‹ç›¤è³‡æ–™ (HPèª¿æ•´) ---
        const boardData = [
            { name: 'å¥åº·å‡ºç™¼', type: 'corner' },
            { name: 'èµ°è·¯/æ­è»Š<br><small>å»è£œç¿’ç­</small>', type: 'property', cost: 150, question: 'ä½ æœ‰æ²’æœ‰æƒ³éï¼Œæ¯å¤©é€šè»Š/èµ°è·¯ä¸Šä¸‹å­¸ï¼Œå…¶å¯¦ä¹Ÿæ˜¯ä¸€ç¨®é‹å‹•ï¼Ÿ' },
            { name: 'å®µå¤œåƒæ³¡éºµ', type: 'negative_event', hp: -300, pillar: 'ç‡Ÿé¤Š', impact: 'é«˜éˆ‰é«˜æ²¹ï¼Œå®¹æ˜“é€ æˆæ°´è…«å’Œé«”é‡å¢åŠ ã€‚', question: 'å®µå¤œæ˜¯ä½ ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†å—ï¼Ÿé€šå¸¸éƒ½åƒäº›ä»€éº¼ï¼Ÿ' },
            { name: 'å¥åº·é£²é£Ÿ<br><small>ä¾¿åˆ©å•†åº—æ²™æ‹‰</small>', type: 'property', cost: 150, question: 'æ˜¨å¤©æœ‰åƒåˆ°è”¬èœæ°´æœå—ï¼Ÿé‚„æ˜¯éƒ½é å¤–é£Ÿè§£æ±ºï¼Ÿ' },
            { name: 'è¦å¾‹é‹å‹•', type: 'special' },
            { name: 'ç„¡è¸å…¬åœ’', type: 'property', cost: 150, question: 'å¦‚æœæœ‹å‹åœ¨æ—é‚Šå¸è¸ï¼ˆåŒ…å«é›»å­è¸ï¼‰ï¼Œä½ æœƒæ€éº¼åšï¼Ÿ' },
            { name: 'ä¸å¥åº·é™·é˜±', type: 'corner' },
            { name: 'é€±æœ«å®…åœ¨å®¶è€å»¢', type: 'negative_event', hp: -300, pillar: 'é‹å‹•', impact: 'ä¹…åä¸å‹•æœƒå°è‡´è‚Œè‚‰åƒµç¡¬ã€æ–°é™³ä»£è¬è®Šæ…¢ã€‚', question: 'é€±æœ«é™¤äº†æ»‘æ‰‹æ©Ÿï¼Œä½ é‚„æœƒåšäº›ä»€éº¼äº‹è®“è‡ªå·±å……é›»ï¼Ÿ' },
            { name: 'ç¨è™•æ™‚é–“<br><small>è½éŸ³æ¨‚/çœ‹æ›¸</small>', type: 'property', cost: 150, question: 'ç•¶ä½ è¦ºå¾—ç…©èºçš„æ™‚å€™ï¼Œæœƒåšä»€éº¼äº‹è®“è‡ªå·±å†·éœä¸‹ä¾†ï¼Ÿ' },
            { name: 'å…­å¤§æ”¯æŸ±', type: 'event' },
            { name: 'å’Œå®¶äººåƒé£¯', type: 'property', cost: 150, question: 'ä½ å¤šä¹…å’Œå®¶äººä¸€èµ·åä¸‹ä¾†å¥½å¥½åƒé “é£¯ï¼Ÿ' },
            { name: 'ç†¬å¤œæ‰“Game/è¿½åŠ‡', type: 'negative_event', hp: -400, pillar: 'ç¡çœ ', impact: 'ç¡çœ ä¸è¶³æœƒå½±éŸ¿éš”æ—¥çš„å°ˆæ³¨åŠ›å’Œè¨˜æ†¶åŠ›ã€‚', question: 'ä½ æ˜¯ä¸æ˜¯ä¹Ÿè¦ºå¾—ï¼Œæ™šä¸Šæ‰æ˜¯è‡ªå·±çš„è‡ªç”±æ™‚é–“ï¼Ÿ' },
            { name: 'è‡ªæˆ‘ç…§é¡§æ—¥', type: 'corner' },
            { name: 'åƒåŠ ç¤¾åœ˜', type: 'property', cost: 150, question: 'åƒåŠ ç¤¾åœ˜æ´»å‹•è®“ä½ å­¸åˆ°äº†ä»€éº¼ï¼Ÿ' },
            { name: 'å ±å‘Šæ‹–åˆ°æ­»ç·šå‰', type: 'negative_event', hp: -300, pillar: 'å£“åŠ›ç®¡ç†', impact: 'æœ€å¾Œä¸€åˆ»çš„å£“åŠ›æœƒå°è‡´ç„¦æ…®å’Œç¡çœ å“è³ªä¸‹é™ã€‚', question: 'ä½ æ˜¯ä¸æ˜¯ä¹Ÿå¸¸å¸¸è¦ºå¾—ã€Œç­‰ä¸€ä¸‹å†åšã€ï¼Œç„¶å¾Œå°±æ²’æœ‰ç„¶å¾Œäº†ï¼Ÿ' },
            { name: 'è¦å¾‹é‹å‹•', type: 'special' },
            { name: 'æ—©ç¡æ—©èµ·', type: 'property', cost: 150, question: 'ä½ è¦ºå¾—æ—©ç¡æ—©èµ·å°ä½ ä¸€å¤©çš„ç²¾ç¥æœ‰ä»€éº¼å½±éŸ¿ï¼Ÿ' },
            { name: 'å…­å¤§æ”¯æŸ±', type: 'event' },
            { name: 'å£ç¿’æ…£ç¹è·¯', type: 'corner' },
            { name: 'è·Ÿç¶²å‹/æœ‹å‹åµæ¶', type: 'negative_event', hp: -300, pillar: 'ç¤¾äº¤é€£çµ', impact: 'è² é¢æƒ…ç·’æœƒå½±éŸ¿äººéš›é—œä¿‚å’Œå¿ƒç†å¥åº·ã€‚', question: 'ç•¶ä½ è·Ÿæœ‹å‹æ„è¦‹ä¸åˆæ™‚ï¼Œä½ æœƒæ€éº¼è™•ç†ï¼Ÿ' },
            { name: 'å…­å¤§æ”¯æŸ±', type: 'event' },
            { name: 'å–å…¨ç³–çç å¥¶èŒ¶', type: 'negative_event', hp: -300, pillar: 'ç‡Ÿé¤Š', impact: 'é«˜ç³–å’Œé«˜ç†±é‡ï¼Œå®¹æ˜“å°è‡´é«”é‡å¢åŠ å’Œè¡€ç³–ä¸ç©©ã€‚', question: 'ä½ å¹³å‡ä¸€å€‹ç¦®æ‹œå–å¹¾æ¯æ‰‹æ–é£²ï¼Ÿ' },
            { name: 'å…­å¤§æ”¯æŸ±', type: 'event' },
            { name: 'é—œå¿ƒèº«é«”', type: 'property', cost: 150, question: 'é™¤äº†èº«é«˜é«”é‡ï¼Œä½ ä¸Šæ¬¡é—œå¿ƒè‡ªå·±çš„å¥åº·ç‹€æ³æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ' }
        ];

        // --- å…­å¤§æ”¯æŸ±äº‹ä»¶å¡ (HPèª¿æ•´) ---
        const eventCards = {
            'ç‡Ÿé¤Š': [
                { text: 'æ—©é¤æœ‰å¥½å¥½åƒï¼Œè€Œä¸æ˜¯éš¨ä¾¿å—‘å€‹éºµåŒ…å°±è¡å‡ºé–€ã€‚', hp: 300, question: 'ä½ ä»Šå¤©æ—©é¤åƒäº†ä»€éº¼ï¼Ÿé‚„æ˜¯ç›´æ¥é¤“åˆ°ä¸­åˆï¼Ÿ' },
                { text: 'åˆé¤åƒé›æ’é…çå¥¶ï¼Œè¶…çˆ½ä½†ä¹Ÿå¥½æ²¹...', hp: -300, question: 'ä½ æ˜¨å¤©æœ‰åƒåˆ°è”¬èœæ°´æœå—ï¼Ÿ' },
                { text: 'å®µå¤œåƒæ³¡éºµåŠ é›æ’ï¼Œéš”å¤©æ°´è…«åˆç–²å‹ã€‚', hp: -300, question: 'å®µå¤œæ˜¯ä½ ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†å—ï¼Ÿé€šå¸¸éƒ½åƒäº›ä»€éº¼ï¼Ÿ' },
                { text: 'æŠŠå«ç³–é£²æ–™ç•¶æ°´å–ï¼Œç²¾ç¥ä¸æ¿Ÿã€‚', hp: -300, question: 'ä½ æ˜¨å¤©å–äº†å¹¾æ¯å«ç³–é£²æ–™ï¼Ÿ' }
            ],
            'é‹å‹•': [
                { text: 'é«”è‚²èª²é›£å¾—é¸åˆ°å–œæ­¡çš„é …ç›®ï¼Œæœ‰å¥½å¥½å‹•ä¸€å‹•ï¼', hp: 300, question: 'ä½ æœ€è¨å­/æœ€å–œæ­¡çš„é«”è‚²èª²é …ç›®æ˜¯ä»€éº¼ï¼Ÿ' },
                { text: 'æ˜æ˜æ·é‹ç«™åªå·®ä¸€ç«™ï¼Œé‚„æ˜¯æ‡¶å¾—èµ°è·¯ã€‚', hp: -200, question: 'ä½ å¹³å‡ä¸€å¤©èµ°è·¯å¹¾æ­¥å‘¢ï¼Ÿ' },
                { text: 'é€±æœ«æ•´å¤©å¾…åœ¨æˆ¿é–“æ‰“å‚³èªªï¼Œè„–å­è¶…åƒµç¡¬ã€‚', hp: -300, question: 'ä½ é€±æœ«æ˜¯ã€Œå‡ºé–€æ´¾ã€é‚„æ˜¯ã€Œåœ¨å®¶æ´¾ã€ï¼Ÿ' }
            ],
            'ç¡çœ ': [
                { text: 'æ™šä¸Š12é»å‰å°±å¯¢ï¼Œæ²’æœ‰å ±å¾©æ€§ç†¬å¤œï¼', hp: 400, question: 'ä½ é€šå¸¸éƒ½å¹¾é»ç¡è¦ºï¼Ÿ' },
                { text: 'ç¡å‰é—œç‡ˆé‚„åœ¨åˆ·IG/TikTokï¼Œçµæœä¸€çœ‹å°±åœä¸ä¸‹ä¾†...', hp: -400, question: 'ä½ ç¡å‰æœƒæ»‘æ‰‹æ©Ÿå—ï¼Ÿæœƒæ»‘å¤šä¹…ï¼Ÿ' },
                { text: 'ç‚ºäº†è¿½åŠ‡è€Œé€šå®µï¼Œä¸Šèª²éƒ½åœ¨æ‰“çŒç¡ã€‚', hp: -400, question: 'ä½ è¦ºå¾—è‡ªå·±æ¯å¤©çš„ç¡çœ æ™‚é–“è¶³å¤ å—ï¼Ÿ' }
            ],
            'å£“åŠ›ç®¡ç†': [
                { text: 'æˆ´ä¸Šè€³æ©Ÿè½å–œæ­¡çš„æ­Œï¼Œæš«æ™‚æŠŠç…©æƒ±éƒ½å¿˜æ‰ã€‚', hp: 300, question: 'ä½ æ„Ÿè¦ºåˆ°å£“åŠ›å¤§æ™‚ï¼Œé€šå¸¸æœƒæ€éº¼åšï¼Ÿ' },
                { text: 'æ®µè€ƒå‰ä¸€å¤©æ‰é–‹å§‹æŠ±ä½›è…³ï¼Œå£“åŠ›å±±å¤§ã€‚', hp: -300, question: 'æœ€è¿‘æœ‰ä»€éº¼äº‹æƒ…è®“ä½ æ„Ÿåˆ°å£“åŠ›æœ€å¤§ï¼Ÿ' },
                { text: 'çœ‹åˆ°æœ‹å‹çš„IGé™å‹•éƒ½æ˜¯å‡ºå»ç©ï¼Œæœƒä¸æœƒè®“ä½ è¦ºå¾—æœ‰é»ç„¦æ…®ï¼Ÿ', hp: -300, question: 'ä½ æ¯å¤©èŠ±å¤šå°‘æ™‚é–“åœ¨ç¤¾ç¾¤åª’é«”ä¸Šï¼Ÿ' },
                { text: 'ä½œæ¥­æ‹–åˆ°æœ€å¾Œä¸€åˆ»æ‰å¯«ï¼Œå£“åŠ›çˆ†è¡¨ã€‚', hp: -300, question: 'ä½ æœ‰æ‹–å»¶çš„ç¿’æ…£å—ï¼Ÿé€šå¸¸æ˜¯ä»€éº¼æƒ…æ³ä¸‹ï¼Ÿ' },
                { text: 'ç‚ºäº†å‡å­¸è€ƒè©¦ï¼Œæ¯å¤©è£œç¿’åˆ°æ·±å¤œï¼Œèº«å¿ƒä¿±ç–²ã€‚', hp: -300, question: 'ä½ å¦‚ä½•å¹³è¡¡èª²æ¥­ã€ç¤¾åœ˜æ´»å‹•å’Œä¼‘æ¯æ™‚é–“å‘¢ï¼Ÿ' }
            ],
            'ç¤¾äº¤é€£çµ': [
                { text: 'åœ¨ç¤¾åœ˜/æ´»å‹•ä¸­èªè­˜äº†èˆˆè¶£ç›¸æŠ•çš„æ–°æœ‹å‹ï¼', hp: 300, question: 'ä½ æœ€è¿‘æœ‰èªè­˜æ–°æœ‹å‹å—ï¼Ÿ' },
                { text: 'è·Ÿç¶²å‹æ‰“äº†ä¸€æ•´æ™šçš„Gameï¼Œä½†å¥½åƒå¾ˆä¹…æ²’è·Ÿç¾å¯¦çš„æœ‹å‹è¦‹é¢äº†...', hp: -300, question: 'ä½ æ¯”è¼ƒå–œæ­¡ç·šä¸ŠèŠå¤©é‚„æ˜¯è·Ÿæœ‹å‹è¦‹é¢ï¼Ÿ' },
                { text: 'åœ¨Dcardæˆ–Meteorä¸Šè·Ÿäººç­†æˆ°ï¼Œè¶…æ°£ï¼', hp: -300, question: 'ç•¶ä½ è·Ÿæœ‹å‹æ„è¦‹ä¸åˆæ™‚ï¼Œä½ æœƒæ€éº¼è™•ç†ï¼Ÿ' }
            ],
            'é¿å…é«˜é¢¨éšªç‰©è³ª': [
                { text: 'æœ‹å‹æªä½ å»å¤œå”±å–é…’ï¼Œä½ ç¦®è²Œæ‹’çµ•äº†ï¼', hp: 500, question: 'å¦‚æœæœ‹å‹é‚€è«‹ä½ å˜—è©¦æ²’æ¥è§¸éçš„æ±è¥¿ï¼Œä½ æœƒæ€éº¼å›æ‡‰ï¼Ÿ' },
                { text: 'åŒå„•æ…«æ¿ä½ æŠ½é›»å­è¸...', special: 'e-cig', question: 'ä½ å°é›»å­è¸æœ‰ä»€éº¼æ¨£çš„çœ‹æ³•ï¼Ÿ' },
                { text: 'ç‚ºäº†ç†¬å¤œè®€æ›¸ï¼ŒçŒäº†å¥½å¹¾ç½èƒ½é‡é£²æ–™ã€‚', hp: -300, question: 'ä½ è¦ºå¾—ç–²å‹çš„æ™‚å€™ï¼Œé™¤äº†å–æç¥é£²æ–™ï¼Œé‚„æœ‰ä»€éº¼å¥½æ–¹æ³•ï¼Ÿ' }
            ]
        };

        // --- éŠæˆ²ç‹€æ…‹ ---
        let player = {
            position: 0,
            hp: STARTING_HP,
            skipTurns: 0
        };
        let currentRound = 0;
        let gameInProgress = true;
        let rollCount = 0;
        let pillarsEncounteredThisCycle = new Set(); 

        // --- DOM å…ƒç´  ---
        const boardElement = document.getElementById('board');
        const playerHPElement = document.getElementById('playerHP');
        const currentRoundElement = document.getElementById('currentRound');
        const diceResultElement = document.getElementById('diceResult');
        const rollDiceBtn = document.getElementById('rollDiceBtn');
        const messageLog = document.getElementById('messageLog');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreElement = document.getElementById('finalScore');
        const manualAddHpInput = document.getElementById('manualAddHpInput'); // æ–°å¢
        const manualAddHpBtn = document.getElementById('manualAddHpBtn'); // æ–°å¢
        
        // --- éŠæˆ²åˆå§‹åŒ– ---
        function initializeGame() {
            boardData.forEach((cellData, index) => {
                const cell = document.createElement('div');
                cell.className = `cell cell-${index} ${cellData.type}`;
                cell.innerHTML = `<span>${cellData.name}</span>`;
                if(cellData.type === 'property') {
                     cell.innerHTML += `<span class="font-bold text-green-600">+${cellData.cost} HP</span>`;
                }
                if(cellData.type === 'negative_event') {
                    cell.innerHTML += `<span class="font-bold text-red-600">${cellData.hp} HP</span>`;
                }
                boardElement.insertBefore(cell, boardElement.firstChild);
            });
            
            const playerPiece = document.createElement('div');
            playerPiece.id = 'playerPiece';
            playerPiece.className = 'player-piece bg-blue-500';
            boardElement.querySelector('.cell-0').appendChild(playerPiece);

            updateUI();
        }

        // --- UI æ›´æ–°å‡½å¼ ---
        function updateUI() {
            playerHPElement.textContent = player.hp;
            currentRoundElement.textContent = `${currentRound} / ${TOTAL_ROUNDS}`;

            const playerPiece = document.getElementById('playerPiece');
            const targetCell = boardElement.querySelector(`.cell-${player.position}`);
            if (playerPiece && targetCell) {
                 targetCell.appendChild(playerPiece);
            }
        }
        
        // --- ç´€éŒ„è¨Šæ¯ ---
        function logMessage(message, color = 'text-gray-800') {
            const p = document.createElement('p');
            p.className = `${color} mb-1`;
            p.innerHTML = message;
            messageLog.appendChild(p);
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        // --- æ“²éª°å­äº‹ä»¶ ---
        rollDiceBtn.addEventListener('click', () => {
            if (!gameInProgress) return;
            
            if (player.skipTurns > 0) {
                logMessage(`ä½ åœ¨<b class="text-red-600">ä¸å¥åº·é™·é˜±</b>ä¸­ï¼Œè·³éé€™å›åˆã€‚ (å‰©ä¸‹ ${player.skipTurns - 1} å›åˆ)`, 'text-red-700');
                player.skipTurns--;
                endTurn();
                return;
            }

            rollCount++;
            rollDiceBtn.disabled = true;
            rollDiceBtn.textContent = 'ç§»å‹•ä¸­...';
            diceResultElement.textContent = '...';
            
            setTimeout(() => {
                const diceRoll = Math.floor(Math.random() * 6) + 1;
                diceResultElement.textContent = diceRoll;
                logMessage(`ä½ æ“²å‡ºäº† <b class="text-red-500">${diceRoll}</b> é»ï¼`);
                movePlayer(diceRoll);
            }, 500);
        });

        // --- æ–°å¢ï¼šæ‰‹å‹•åŠ é»äº‹ä»¶ ---
        manualAddHpBtn.addEventListener('click', () => {
            const value = parseInt(manualAddHpInput.value, 10);
            if (isNaN(value)) {
                logMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ã€‚', 'text-red-700');
                return;
            }
            player.hp += value;
            const actionText = value >= 0 ? 'å¢åŠ ' : 'æ¸›å°‘';
            const absValue = Math.abs(value);
            logMessage(`æ‰‹å‹•${actionText}äº† <b class="text-blue-600">${absValue}</b> HPã€‚`, 'text-blue-700');
            updateUI();
            manualAddHpInput.value = '';
        });
        
        // --- ç§»å‹•ç©å®¶ ---
        async function movePlayer(steps) {
            for (let i = 0; i < steps; i++) {
                player.position = (player.position + 1) % boardData.length;
                updateUI();
                if (player.position === 0) {
                    player.hp += PASS_START_HP;
                    logMessage(`ç¶“é<b class="text-green-600">å¥åº·å‡ºç™¼</b>é»ï¼Œç²å¾— ${PASS_START_HP} HPï¼`, 'text-green-700');
                    updateUI();
                }
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            handleLanding();
        }

        // --- è™•ç†ç©å®¶åœç•™çš„æ ¼å­ ---
        function handleLanding() {
            const currentCell = boardData[player.position];
            logMessage(`ä½ æŠµé”äº† <b class="text-blue-600">${currentCell.name}</b>ã€‚`);

            switch (currentCell.type) {
                case 'property':
                    player.hp += currentCell.cost;
                    logMessage(`é¤Šæˆå¥½ç¿’æ…£ï¼ç²å¾— ${currentCell.cost} HPã€‚`, 'text-green-700');
                    if (currentCell.question) {
                        logMessage(`<b>ã€æå•ã€‘</b>${currentCell.question}`, 'text-purple-600');
                    }
                    break;
                case 'negative_event':
                    player.hp += currentCell.hp;
                    logMessage(`è¸©åˆ°å£ç¿’æ…£é™·é˜±ï¼šã€Œ${currentCell.name}ã€ã€‚HP <b class="text-red-600">${currentCell.hp}</b>ã€‚`, 'text-red-700');
                    logMessage(`<b>[${currentCell.pillar}]</b> ${currentCell.impact}`, 'text-gray-600');
                    if (currentCell.question) {
                        logMessage(`<b>ã€æå•ã€‘</b>${currentCell.question}`, 'text-purple-600');
                    }
                    pillarsEncounteredThisCycle.add(currentCell.pillar);
                    break;
                case 'event':
                    const forceNegative = rollCount % 3 === 0;
                    triggerEvent(forceNegative);
                    break;
                case 'special':
                    const roll = Math.floor(Math.random() * 6) + 1;
                    logMessage(`é€²è¡Œè¦å¾‹é‹å‹•...æ“²éª°å¾—åˆ° <b class="text-red-500">${roll}</b>ã€‚`);
                    if (roll % 2 === 0) {
                        player.hp += 300;
                        logMessage(`æ˜¯å¶æ•¸ï¼é‹å‹•è®“ä½ æ›´æœ‰æ´»åŠ›ï¼Œ+300 HPã€‚`, 'text-green-700');
                    } else {
                        player.hp -= 200;
                        logMessage(`æ˜¯å¥‡æ•¸...é‹å‹•æœ‰é»æ‹‰å‚·ï¼Œ-200 HPã€‚`, 'text-yellow-700');
                    }
                    logMessage(`<b>ã€æå•ã€‘</b>ä½ ä¸Šä¸€æ¬¡é‹å‹•æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ`, 'text-purple-600');
                    break;
                case 'corner':
                    handleCorner(currentCell.name);
                    break;
            }
            
            setTimeout(() => {
                endTurn();
            }, 1000);
        }

        // --- è™•ç†è§’è½æ ¼å­ ---
        function handleCorner(name) {
             switch (name) {
                case 'è‡ªæˆ‘ç…§é¡§æ—¥':
                    player.hp += 500;
                    logMessage(`ä»Šå¤©æ˜¯è‡ªæˆ‘ç…§é¡§æ—¥ï¼å¥½å¥½æ”¾é¬†ï¼Œ+500 HPã€‚`, 'text-purple-700');
                    logMessage(`<b>ã€æå•ã€‘</b>ä½ é€šå¸¸å¦‚ä½•æ”¾é¬†è‡ªå·±ã€ç…§é¡§è‡ªå·±çš„æƒ…ç·’å‘¢ï¼Ÿ`, 'text-purple-600');
                    break;
                case 'å£ç¿’æ…£ç¹è·¯':
                    logMessage(`ä½ èµ°äº†å£ç¿’æ…£çš„æ·å¾‘...ç›´æ¥å‰å¾€<b class="text-red-600">ä¸å¥åº·é™·é˜±</b>ï¼`, 'text-red-700');
                    player.position = boardData.findIndex(cell => cell.name === 'ä¸å¥åº·é™·é˜±');
                    player.skipTurns = 2;
                    logMessage(`ä½ éœ€è¦è·³é 2 æ¬¡è¡Œå‹•ã€‚`);
                    logMessage(`<b>ã€æå•ã€‘</b>åœ¨ç”Ÿæ´»ä¸­ï¼Œæœ‰æ²’æœ‰ä»€éº¼ã€Œå£ç¿’æ…£çš„æ·å¾‘ã€æ˜¯ä½ æƒ³è¦é¿é–‹çš„ï¼Ÿ`, 'text-purple-600');
                    updateUI();
                    break;
                case 'ä¸å¥åº·é™·é˜±':
                     logMessage('åªæ˜¯ä¾†çœ‹çœ‹ï¼Œæ²’æœ‰å—ç½°ã€‚');
                     logMessage(`<b>ã€æå•ã€‘</b>åœ¨ç¾å¯¦ç”Ÿæ´»ä¸­ï¼Œä½ å¯ä»¥å¦‚ä½•è¾¨è­˜ä¸¦é¿é–‹å°å¥åº·æœ‰å®³çš„ã€Œé™·é˜±ã€ï¼Ÿ`, 'text-purple-600');
                    break;
             }
        }

        // --- è§¸ç™¼å…­å¤§æ”¯æŸ±äº‹ä»¶ ---
        function triggerEvent(forceNegative = false) {
            if (forceNegative) {
                logMessage(`<b>å„é‹é™è‡¨ï¼</b>ä¼¼ä¹æ˜¯å£ç¿’æ…£æ‰¾ä¸Šé–€äº†...`, 'text-purple-700');
            }
            const pillars = Object.keys(eventCards);
            const randomPillar = pillars[Math.floor(Math.random() * pillars.length)];
            pillarsEncounteredThisCycle.add(randomPillar);
            
            let possibleEvents = eventCards[randomPillar];

            if (forceNegative) {
                const negativeEvents = possibleEvents.filter(event => event.hp < 0 || event.special);
                if (negativeEvents.length > 0) {
                    possibleEvents = negativeEvents;
                }
            }

            const randomEvent = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];

            logMessage(`è§¸ç™¼ <b class="text-yellow-600">${randomPillar}</b> äº‹ä»¶ï¼`);
            logMessage(`èªªæ˜ï¼š${randomEvent.text}`);

            if (randomEvent.hp) {
                player.hp += randomEvent.hp;
                const hpText = randomEvent.hp > 0 ? `+${randomEvent.hp}` : randomEvent.hp;
                const color = randomEvent.hp > 0 ? 'text-green-700' : 'text-red-700';
                logMessage(`HP <b class="${color}">${hpText}</b>`, color);
            }

            if (randomEvent.special === 'e-cig') {
                const roll = Math.floor(Math.random() * 6) + 1;
                logMessage(`ä½ æ“²éª°æ±ºå®šå¦‚ä½•æ‡‰å°...é»æ•¸æ˜¯ <b class="text-red-500">${roll}</b>ã€‚`);
                if (roll % 2 === 0) {
                    player.hp += 300;
                    logMessage('æ˜¯å¶æ•¸ï¼ä½ å …å®šåœ°æ‹’çµ•äº†ï¼Œè´å¾—å°Šé‡ï¼+300 HPã€‚', 'text-green-700');
                } else {
                    player.hp -= 500;
                    logMessage('æ˜¯å¥‡æ•¸...ä½ çŒ¶è±«äº†ä¸€ä¸‹ï¼Œå°å¥åº·é€ æˆå·¨å¤§é¢¨éšªï¼-500 HPã€‚', 'text-red-700');
                }
            }

            if (randomEvent.question) {
                logMessage(`<b>ã€æå•ã€‘</b>${randomEvent.question}`, 'text-purple-600');
            }
        }

        // --- çµæŸå›åˆ ---
        function endTurn() {
            currentRound++;
            
            if (currentRound > 0 && currentRound % 6 === 0) {
                handlePillarReview();
            }

            updateUI();

            if (player.hp <= 0) {
                player.hp = 0;
                gameOver('ä½ çš„å¥åº·é»æ•¸æ­¸é›¶äº†...');
            } else if (currentRound >= TOTAL_ROUNDS) {
                gameOver('10 å›åˆçµæŸï¼');
            } else {
                rollDiceBtn.disabled = false;
                rollDiceBtn.textContent = 'æ“²éª°å­ ğŸ²';
            }
        }

        // --- 6å›åˆæ”¯æŸ±ç¸½å›é¡§å‡½å¼ (æ›´æ–°ç‚ºåŠ ç¸½åˆ†) ---
        function handlePillarReview() {
            logMessage(`--- ç¬¬ ${currentRound} å›åˆï¼šç”Ÿæ´»æ”¯æŸ±ç¸½å›é¡§ ---`, 'text-indigo-600 font-bold');
            const pillarCount = pillarsEncounteredThisCycle.size;
            
            const encounteredPillarsText = pillarCount > 0 ? Array.from(pillarsEncounteredThisCycle).join(', ') : 'ç„¡';
            logMessage(`æœ¬é€±æœŸæ¥è§¸éçš„æ”¯æŸ± (${pillarCount}/6): ${encounteredPillarsText}`);

            if (pillarCount >= 5) {
                player.hp += 500;
                logMessage(`ç”Ÿæ´»éå¸¸å‡è¡¡ï¼Œåšå¾—å¾ˆå¥½ï¼HP <b class="text-green-600">+500</b>`, 'text-green-700');
            } else if (pillarCount >= 3) {
                player.hp += 200;
                logMessage(`ç”Ÿæ´»é‚„ç®—å‡è¡¡ï¼Œç¹¼çºŒä¿æŒï¼HP <b class="text-green-600">+200</b>`, 'text-green-700');
            } else {
                player.hp -= 300;
                logMessage(`ç”Ÿæ´»æœ‰é»å¤±è¡¡ï¼Œè¦å¤šæ³¨æ„å…¶ä»–æ–¹é¢ï¼HP <b class="text-red-600">-300</b>`, 'text-red-700');
            }
            
            pillarsEncounteredThisCycle.clear();
            logMessage('ä¸‹ä¸€é€±æœŸçš„æ”¯æŸ±ç´€éŒ„å·²é‡ç½®ã€‚');
        }

        // --- éŠæˆ²çµæŸ (æ›´æ–°ç‚ºé¡¯ç¤ºç¸½åˆ†) ---
        function gameOver(message) {
            gameInProgress = false;
            rollDiceBtn.disabled = true;
            rollDiceBtn.textContent = 'éŠæˆ²çµæŸ';
            
            finalScoreElement.textContent = player.hp;
            finalScoreElement.className = player.hp > STARTING_HP ? 'text-8xl font-bold text-green-500 mb-8' : 'text-8xl font-bold text-red-500 mb-8';

            document.getElementById('modalMessage').textContent = message;
            
            setTimeout(() => {
                gameOverModal.classList.remove('hidden');
                setTimeout(() => {
                    gameOverModal.classList.add('opacity-100');
                    gameOverModal.querySelector('div').classList.add('scale-100');
                }, 10);
            }, 1000);
            
            logMessage(`--- éŠæˆ²çµæŸ ---`, 'font-bold');
            logMessage(`æœ€çµ‚HP: <b class="text-2xl">${player.hp}</b>`);

            if (player.hp > STARTING_HP) {
                logMessage(`æ­å–œä½ æˆç‚º <b class="text-indigo-600">å¥åº·ç”Ÿæ´»å† è»</b>ï¼`);
            } else {
                logMessage(`å†æ¥å†å²ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼`);
            }
        }

        // --- å•Ÿå‹•éŠæˆ² ---
        initializeGame();
    </script>
</body>
</html>

